# Yupoo Product Scraper

This project consists of a simple full‑stack web application that
scrapes cover images from a Yupoo site, generates descriptive tags
using basic computer vision techniques, stores the results in a
database and exposes an API for searching the indexed products by tag.
The frontend is built with React, TypeScript and Tailwind CSS, while
the backend uses FastAPI.

## Components

```
yupoo_app/
├── backend/      # FastAPI application and helper modules
│   ├── database.py
│   ├── scraper.py
│   ├── vision.py
│   ├── main.py    # FastAPI entry point
│   └── ...
├── frontend/     # React application (Vite + Tailwind CSS)
│   ├── src/
│   │   ├── App.tsx
│   │   ├── index.css
│   │   └── main.tsx
│   ├── index.html
│   └── ...
└── README.md
```

## Running the backend

1. Ensure you have Python 3.8 or newer installed.
2. Install the dependencies listed in `yupoo_app/requirements.txt`:

   ```bash
   pip install -r requirements.txt
   ```

   The backend relies on `fastapi`, `uvicorn`, `requests`, `beautifulsoup4`,
   `pydantic`, `numpy` and `opencv-python`. If OpenCV is already installed
   on your system you may omit it from installation.

3. Start the FastAPI server:

   ```bash
   uvicorn yupoo_app.backend.main:app --reload
   ```

   The API will be available at `http://localhost:8000`. You can visit
   `http://localhost:8000/docs` to explore the automatically generated
   Swagger UI.

### Endpoints

- `POST /api/scrape` – Scrape a Yupoo site. Example request body:

  ```json
  {
    "base_url": "https://deateath.x.yupoo.com",
    "max_albums": 50
  }
  ```

  This endpoint visits the provided site, extracts up to `max_albums`
  album links and their cover images, generates tags for each cover
  image (dominant colours, brightness and aspect ratio) and stores
  them in an SQLite database (`yupoo.db`). It returns the number of
  albums processed and the number of products successfully inserted.

- `GET /api/products?tags=tag1,tag2` – Search for products whose tags
  include all provided comma‑separated tags. Tags are case sensitive
  and follow the format generated by the vision module (e.g.
  `color_red`, `brightness_dark`, `aspect_wide`). Returns a list of
  product objects containing an identifier, the cover image URL, a list
  of tags and the link back to the original album.

- `GET /api/products/all` – Return all stored products (useful for
  development/testing).

## Running the frontend

The frontend is a Vite‑powered React application that communicates
with the FastAPI backend. It provides a simple interface to search
products by tags and display the corresponding covers and links.

1. Ensure you have Node.js (v16 or newer) and npm installed.
2. Navigate to the `frontend` directory and install dependencies:

   ```bash
   cd frontend
   npm install
   ```

3. Start the development server:

   ```bash
   npm run dev
   ```

   This will start Vite on `http://localhost:5173`. The app assumes
   that the API is reachable at `http://localhost:8000`. If your API
   runs on a different host/port you can specify a custom base URL via
   an environment variable when launching Vite:

   ```bash
   VITE_API_BASE_URL="http://your-api-host:port" npm run dev
   ```

4. Open the app in your browser, enter one or more tags separated by
   commas (e.g. `color_blue,brightness_bright`) and click
   **Search**. Matching products will be displayed with their cover
   image, tags and a link back to the original Yupoo album.

## Extending the vision module

The current implementation of `vision.py` extracts simple properties
from each image: dominant colours, brightness and aspect ratio. To
make the product catalogue more useful, consider incorporating
advanced computer vision techniques such as:

* **Object classification** – Use a pre‑trained convolutional neural
  network to recognise high‑level categories (e.g. bags, shoes,
  clothing). Libraries like `torchvision` provide ready‑made models
  which you can load if your environment supports PyTorch.
* **Object detection** – Identify multiple objects in a single image
  and tag them separately. Models like YOLO or SSD can detect
  accessories, logos or textures.
* **Text extraction** – If product images contain labels or brand
  names, apply an OCR engine like Tesseract to extract text and add
  it as additional tags.

Replace or augment the `generate_tags_for_image` function in
`vision.py` with your custom logic and return any number of
descriptive tags as strings.